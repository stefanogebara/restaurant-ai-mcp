# Add ML Prediction Fields to Reservations Table

## Phase 1.2: ML Field Setup for Reservations

This document provides step-by-step instructions for adding 5 essential ML prediction fields to the Reservations table.

---

## Quick Summary

Add these 5 fields to store ML no-show predictions:
1. **ML Risk Score** - Numeric probability (0-100)
2. **ML Risk Level** - Category (low/medium/high/very-high)
3. **ML Confidence** - Model confidence (0-100)
4. **ML Model Version** - Model version string
5. **ML Prediction Timestamp** - When prediction was made

---

## Setup Instructions

### Step 1: Open Reservations Table
Navigate to: https://airtable.com/appm7zo5vOf3c3rqm/tbloL2huXFYQluomn

### Step 2: Add Each Field

Click the **"+"** button (add field) at the right end of the table header.

---

#### Field 1: ML Risk Score
- **Field Name**: `ML Risk Score`
- **Field Type**: **Number**
- **Format**:
  - Precision: **2 decimal places**
  - Allow negative numbers: **No**
- **Description**:
  ```
  ML model no-show probability (0.00 to 100.00).
  Higher score = higher risk of no-show.
  Generated by XGBoost model v2.0.0.
  ```

---

#### Field 2: ML Risk Level
- **Field Name**: `ML Risk Level`
- **Field Type**: **Single select**
- **Options** (add in this order with colors):
  1. `low` (Green)
  2. `medium` (Yellow)
  3. `high` (Orange)
  4. `very-high` (Red)
- **Description**:
  ```
  Risk category based on ML Risk Score:
  - low: 0-25
  - medium: 25-50
  - high: 50-75
  - very-high: 75-100
  ```

---

#### Field 3: ML Confidence
- **Field Name**: `ML Confidence`
- **Field Type**: **Number**
- **Format**:
  - Precision: **2 decimal places**
  - Allow negative numbers: **No**
- **Description**:
  ```
  Model confidence in prediction (0.00 to 100.00).
  Higher confidence = more reliable prediction.
  Based on feature quality and historical accuracy.
  ```

---

#### Field 4: ML Model Version
- **Field Name**: `ML Model Version`
- **Field Type**: **Single line text**
- **Description**:
  ```
  Version of ML model used for prediction (e.g., "v2.0.0").
  Allows tracking which model version made the prediction.
  Current production model: v2.0.0 (85.3% ROC-AUC).
  ```

---

#### Field 5: ML Prediction Timestamp
- **Field Name**: `ML Prediction Timestamp`
- **Field Type**: **Date & Time**
- **Format**:
  - Date format: **ISO (2025-10-31)**
  - Time format: **24 hour (14:30)**
  - Include time: **Yes**
  - Time zone: **GMT**
- **Description**:
  ```
  When the ML prediction was generated.
  Updated each time prediction is recalculated.
  Used for tracking prediction freshness and audit trail.
  ```

---

## Verification Checklist

After adding all fields, verify:
- [ ] All 5 fields appear in the Reservations table
- [ ] ML Risk Level has 4 options (low/medium/high/very-high)
- [ ] ML Risk Score and ML Confidence allow decimals
- [ ] ML Prediction Timestamp includes both date and time
- [ ] Field descriptions are clear and complete

---

## Integration Points

Once fields are added, update these files:

### 1. Environment Variables (no changes needed)
The Reservations table ID is already configured:
```bash
RESERVATIONS_TABLE_ID=tbloL2huXFYQluomn
```

### 2. Update Prediction Storage (Phase 1.3)
File: `api/predictive-analytics.js`
- Update field names to match exact Airtable names
- Store all 5 ML fields when making predictions
- Current issue: Fields don't exist, causing predictions to be discarded

### 3. Backfill Existing Reservations (Phase 1.4)
After fields are added:
```bash
node scripts/backfill-ml-predictions.js
```

---

## Field Mapping Reference

| Code Variable | Airtable Field Name |
|---------------|---------------------|
| `mlRiskScore` | `ML Risk Score` |
| `mlRiskLevel` | `ML Risk Level` |
| `mlConfidence` | `ML Confidence` |
| `mlModelVersion` | `ML Model Version` |
| `mlPredictionDate` | `ML Prediction Timestamp` |

---

## Example Populated Record

```json
{
  "Reservation ID": "RES-20251031-1234",
  "Customer Name": "John Smith",
  "Party Size": 2,
  "Date": "2025-11-05",
  "Time": "19:00",
  "Status": "Confirmed",

  // ML PREDICTION FIELDS
  "ML Risk Score": 23.45,
  "ML Risk Level": "low",
  "ML Confidence": 87.32,
  "ML Model Version": "v2.0.0",
  "ML Prediction Timestamp": "2025-10-31T10:30:00Z"
}
```

---

## Next Steps

1. ✅ Complete field setup (this document)
2. ⏭️ **Phase 1.3**: Fix `api/predictive-analytics.js` to use new field names
3. ⏭️ **Phase 1.4**: Run backfill script to populate existing reservations
4. ⏭️ **Phase 1.5**: Test end-to-end prediction flow

---

## Troubleshooting

### Field not saving values
- Check field type matches specification exactly
- Ensure number fields allow the full range (0-100)
- Verify Single select options are typed correctly (case-sensitive)

### ML predictions still failing
- Run: `node scripts/test-ml-prediction.js`
- Check API logs for exact error message
- Verify field names match exactly (including spaces, capitalization)

### Need to rename a field
1. Click field header → "Customize field type"
2. Change name in "Field name" box
3. Update code references in `api/predictive-analytics.js`

---

**Estimated Time**: 10-15 minutes

**Status**: Ready for manual setup

**Last Updated**: 2025-10-31
